<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cantina do Erlach</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="notification-area" aria-live="polite"></div>

    <div id="login-page" class="login-container">
        <div class="login-box">
            <h2>Login - Cantina Erlach</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" placeholder="Digite seu e-mail" required value="admin@cantina.com">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>
                <div class="buttons">
                    <button id="login-btn" class="btn-primary">Entrar</button>
                </div>
                <p id="login-error" class="error-message"></p>
            </div>
        </div>
    </div>

    <div id="app-content" style="display: none;">
        <div class="container">
            <header>
                <button id="menu-toggle" class="menu-toggle" tabindex="0"><i class="fas fa-bars"></i></button>
                <h1>Sistema de Cantina do Erlach</h1>
                <button id="logout-btn" class="btn-secondary">Sair</button>
                <nav>
                    <ul class="menu" id="main-menu">
                        <li><a href="#" class="menu-item active" data-target="home">Início</a></li>
                        <li><a href="#" class="menu-item" data-target="alunos">Alunos</a></li>
                        <li><a href="#" class="menu-item" data-target="produtos">Produtos</a></li>
                        <li><a href="#" class="menu-item" data-target="consumo">Registrar Consumo</a></li>
                        <li><a href="#" class="menu-item" data-target="relatorios">Relatórios</a></li>
                        <li><a href="#" class="menu-item" data-target="mensagens">Mensagens</a></li>
                        <li><a href="#" class="menu-item" data-target="ganhos">Ganhos</a></li>
                    </ul>
                </nav>
            </header>
            
            <main>
                <section id="home" class="page active">
                    <div class="dashboard">
                        <h2>Dashboard</h2>
                        <div class="cards">
                            <div class="card">
                                <i class="fas fa-user-graduate"></i>
                                <h3>Alunos</h3>
                                <p id="total-alunos">0 cadastrados</p>
                                <button class="btn-primary" onclick="navegarPara('alunos')">Gerenciar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-cookie-bite"></i>
                                <h3>Produtos</h3>
                                <p id="total-produtos">0 cadastrados</p>
                                <button class="btn-primary" onclick="navegarPara('produtos')">Gerenciar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-cash-register"></i>
                                <h3>Vendas Hoje</h3>
                                <p id="vendas-hoje">R$ 0,00</p>
                                <button class="btn-primary" onclick="navegarPara('consumo')">Registrar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-chart-line"></i>
                                <h3>Relatórios</h3>
                                <p>Visualizar resumos</p>
                                <button class="btn-primary" onclick="navegarPara('relatorios')">Acessar</button>
                            </div>
                            <div class="card">
                                <i class="fab fa-whatsapp"></i>
                                <h3>Mensagens Recentes</h3>
                                <p id="total-mensagens">0 mensagens</p>
                                <button class="btn-primary" onclick="navegarPara('mensagens')">Visualizar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-dollar-sign"></i>
                                <h3>Ganhos Totais</h3>
                                <p id="ganhos-totais">R$ 0,00</p>
                                <button class="btn-primary" onclick="navegarPara('ganhos')">Detalhes</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="alunos" class="page">
                    <h2>Cadastro de Alunos</h2>
                    <div class="form-container">
                        <form id="aluno-form">
                            <div class="form-group required">
                                <label for="nome-aluno">Nome do Aluno:</label>
                                <input type="text" id="nome-aluno" required>
                            </div>
                            <div class="form-group required">
                                <label for="serie-aluno">Série:</label>
                                <select id="serie-aluno" required>
                                    <option value="">Selecione a série</option>
                                    <option value="Maternal">Maternal</option>
                                    <option value="Jardim I">Jardim I</option>
                                    <option value="Jardim II">Jardim II</option>
                                    <option value="1º ano">1º ano</option>
                                    <option value="2º ano">2º ano</option>
                                    <option value="3º ano">3º ano</option>
                                    <option value="4º ano">4º ano</option>
                                    <option value="5º ano">5º ano</option>
                                    <option value="6º ano">6º ano</option>
                                    <option value="7º ano">7º ano</option>
                                    <option value="8º ano">8º ano</option>
                                    <option value="9º ano">9º ano</option>
                                    <option value="Professor/a">Professor/a</option>
                                </select>
                            </div>
                            <div class="form-group required">
                                <label for="responsavel-aluno">Nome do Responsável:</label>
                                <input type="text" id="responsavel-aluno" required>
                            </div>
                            <div class="form-group required">
                                <label for="contato-aluno">WhatsApp do Responsável:</label>
                                <input type="tel" id="contato-aluno" placeholder="(XX) XXXXX-XXXX" required>
                            </div>
                            <div class="form-group">
                                <label for="pix-aluno">Chave PIX:</label>
                                <input type="text" id="pix-aluno">
                            </div>
                            <div class="buttons">
                                <button type="submit" class="btn-primary">Salvar</button>
                                <button type="reset" class="btn-secondary">Limpar</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="search-container">
                        <input type="text" id="buscar-aluno" placeholder="Buscar aluno...">
                        <button class="btn-search"><i class="fas fa-search"></i></button>
                    </div>

                    <div class="table-container" id="tabela-alunos-container" style="display: none;">
                        <table id="tabela-alunos">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Série</th>
                                    <th>Responsável</th>
                                    <th>WhatsApp</th>
                                    <th>PIX</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dados dos alunos inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="produtos" class="page">
                    <h2>Cadastro de Produtos</h2>
                    <div class="form-container">
                        <form id="produto-form">
                            <div class="form-group required">
                                <label for="nome-produto">Nome do Produto:</label>
                                <input type="text" id="nome-produto" required>
                            </div>
                            <div class="form-group required">
                                <label for="preco-produto">Preço (R$):</label>
                                <input type="number" id="preco-produto" min="0.01" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="imagem-produto">Imagem (URL):</label>
                                <input type="url" id="imagem-produto" placeholder="https://...">
                            </div>
                            <div class="buttons">
                                <button type="submit" class="btn-primary">Salvar</button>
                                <button type="reset" class="btn-secondary">Limpar</button>
                            </div>
                        </form>
                    </div>

                    <div class="search-container">
                        <input type="text" id="buscar-produto" placeholder="Buscar produto...">
                        <button class="btn-search"><i class="fas fa-search"></i></button>
                    </div>

                    <div class="produtos-grid" id="lista-produtos">
                        <!-- Produtos serão inseridos via JavaScript -->
                    </div>
                </section>

                <section id="consumo" class="page">
                    <h2>Registro de Consumo</h2>
                    
                    <div class="form-container">
                        <form id="consumo-form">
                            <div class="form-group required">
                                <label for="buscar-aluno-consumo">Buscar Aluno:</label>
                                <input type="text" id="buscar-aluno-consumo" placeholder="Digite o nome do aluno" required>
                                <div id="aluno-lista" class="aluno-lista">
                                    <!-- Resultados da busca de alunos serão inseridos aqui -->
                                </div>
                                <input type="hidden" id="aluno-id-selecionado" name="aluno-id">
                            </div>
                            
                            <div class="form-group required">
                                <label for="data-consumo">Data:</label>
                                <input type="date" id="data-consumo" required>
                            </div>

                            <h3>Selecione os Produtos</h3>
                            <div class="search-container">
                                <input type="text" id="buscar-produto-consumo" placeholder="Buscar produto...">
                                <button class="btn-search"><i class="fas fa-search"></i></button>
                            </div>
                            <div id="produtos-consumo" class="produtos-selecao" style="display: none;">
                                <!-- Produtos serão inseridos via JavaScript -->
                            </div>

                            <div class="resumo-consumo">
                                <h3>Resumo do Pedido</h3>
                                <div id="itens-selecionados">
                                    <!-- Itens selecionados serão inseridos via JavaScript -->
                                    <p class="empty-message">Nenhum item selecionado</p>
                                </div>
                                <div class="total">
                                    <p>Total: <span id="total-consumo">R$ 0,00</span></p>
                                </div>
                            </div>

                            <div class="buttons">
                                <button type="submit" class="btn-primary">Registrar Consumo</button>
                                <button type="reset" class="btn-secondary">Limpar</button>
                            </div>
                        </form>
                    </div>

                    <div class="historico-container">
                        <div class="historico-header">
                            <h3>Consumos Recentes</h3>
                            <button id="toggle-consumos" class="btn-secondary">
                                <i class="fas fa-chevron-down"></i> Mostrar
                            </button>
                        </div>
                        <div id="consumos-recentes" style="display: none;">
                            <div class="nav-semana">
                                <button id="prev-semana" class="btn-secondary">Semana Anterior</button>
                                <input type="week" id="seletor-semana" required>
                                <button id="next-semana" class="btn-secondary">Próxima Semana</button>
                            </div>
                            <div class="table-container">
                                <table id="tabela-consumos">
                                    <thead>
                                        <tr>
                                            <th>Data</th>
                                            <th>Aluno</th>
                                            <th>Itens</th>
                                            <th>Total</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Dados dos consumos inseridos via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="relatorios" class="page">
                    <h2>Relatórios Semanais</h2>
                    
                    <div class="form-container">
                        <div class="form-group required">
                            <label for="semana-relatorio">Selecione a Semana:</label>
                            <input type="week" id="semana-relatorio" required>
                        </div>
                        <div class="form-group">
                            <label for="aluno-relatorio">Selecione o Aluno:</label>
                            <select id="aluno-relatorio">
                                <option value="">Todos os alunos</option>
                                <!-- Opções preenchidas via JavaScript com atualizarSelectAlunos() -->
                            </select>
                        </div>
                        <div class="buttons">
                            <button id="gerar-relatorio" class="btn-primary">Gerar Relatório</button>
                            <button id="exportar-relatorio" class="btn-secondary">Exportar CSV</button>
                        </div>
                    </div>

                    <div id="resultado-relatorio" class="relatorio-container">
                        <h3>Resumo Semanal</h3>
                        <div class="table-container">
                            <table id="tabela-relatorio">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Status</th>
                                        <th>Aluno</th>
                                        <th>Série</th>
                                        <th>Itens Consumidos</th>
                                        <th>Total</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados do relatório inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="mensagens" class="page">
                    <h2>Envio de Mensagens</h2>
                    
                    <div class="form-container">
                        <div class="form-group required">
                            <label for="semana-mensagem">Selecione a Semana:</label>
                            <input type="week" id="semana-mensagem" required>
                        </div>
                        <div class="buttons">
                            <button id="gerar-mensagens" class="btn-primary">Gerar Mensagens</button>
                        </div>
                    </div>

                    <div id="lista-mensagens" class="mensagens-container">
                        <!-- Mensagens serão inseridas via JavaScript -->
                    </div>
                </section>

                <section id="ganhos" class="page">
                    <h2>Ganhos Semanais e Mensais</h2>
                    
                    <div class="form-container">
                        <div class="form-group required">
                            <label for="ano-ganhos">Selecione o Ano:</label>
                            <select id="ano-ganhos" required>
                                <option value="">Selecione o ano</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                        <div class="buttons">
                            <button id="gerar-ganhos" class="btn-primary">Gerar Resumo</button>
                            <button id="exportar-ganhos" class="btn-secondary">Exportar CSV</button>
                        </div>
                    </div>

                    <div id="resultado-ganhos" class="ganhos-container">
                        <h3>Ganhos Semanais</h3>
                        <div class="table-container">
                            <table id="tabela-ganhos-semanais">
                                <thead>
                                    <tr>
                                        <th>Semana</th>
                                        <th>Período</th>
                                        <th>Total (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados dos ganhos semanais inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <h3>Ganhos Mensais</h3>
                        <div class="table-container">
                            <table id="tabela-ganhos-mensais">
                                <thead>
                                    <tr>
                                        <th>Mês</th>
                                        <th>Total (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados dos ganhos mensais inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </main>

            <div class="fab-container">
                <button class="fab-main btn-primary" id="fab-main" tabindex="0">
                    <i class="fas fa-plus"></i>
                </button>
                <div class="fab-menu" id="fab-menu">
                    <button class="fab-item btn-primary" data-target="alunos" title="Cadastrar Aluno">
                        <i class="fas fa-user-graduate"></i>
                        <span>Cadastrar Aluno</span>
                    </button>
                    <button class="fab-item btn-primary" data-target="consumo" title="Registrar Consumo">
                        <i class="fas fa-cash-register"></i>
                        <span>Registrar Consumo</span>
                    </button>
                    <button class="fab-item btn-primary" data-target="mensagens" title="Gerar Mensagens">
                        <i class="fab fa-whatsapp"></i>
                        <span>Gerar Mensagens</span>
                    </button>
                </div>
            </div>

            <footer>
                <p>© 2025 Sistema de Cantina do Erlach. Desenvolvida por Werisder Bertoli.</p>
            </footer>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmação</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <p id="modal-message">Tem certeza que deseja excluir este item?</p>
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="btn-secondary">Cancelar</button>
                <button id="modal-confirm" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, setDoc, deleteDoc, doc, getDocs, query, where, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyDckbCik-4x5nl1QU81q-sTmlhQQMnBUII",
            authDomain: "cantinaescolar-d73bc.firebaseapp.coe",
            projectId: "cantinaescolar-d73bc",
            storageBucket: "cantinaescolar-d73bc.appspot.com",
            messagingSenderId: "457335631363",
            appId: "1:457335631363:web:cbd9b38e1be1bb50d56836"
        };
    
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
    
        console.log("Firebase inicializado:", app.name);
        console.log("Firestore:", db);
        console.log("Auth:", auth);
    
        window.db = db;
        window.firestoreModules = { collection, onSnapshot, addDoc, setDoc, deleteDoc, doc, getDocs, query, where, updateDoc };
        window.firebaseAuthModules = { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged };
    </script>
    <script defer src="src/main.js"></script>
</body>
</html>