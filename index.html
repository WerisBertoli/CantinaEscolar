<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cantina do Erlach</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Tela de Login -->
    <div id="login-page" class="login-container">
        <div class="login-box">
            <h2>Login - Cantina Erlach</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" placeholder="Digite seu e-mail" required value="admin@cantina.com">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>
                <div class="buttons">
                    <button id="login-btn" class="btn-primary">Entrar</button>
                </div>
                <p id="login-error" class="error-message"></p>
            </div>
        </div>
    </div>

    <!-- Conteúdo principal da aplicação (oculto até o login) -->
    <div id="app-content" style="display: none;">
        <div class="container">
            <header>
                <h1>Sistema de Cantina do Erlach</h1>
                <button id="logout-btn" class="btn-secondary">Sair</button>
                <nav>
                    <ul class="menu">
                        <li><a href="#" class="menu-item active" data-target="home">Início</a></li>
                        <li><a href="#" class="menu-item" data-target="alunos">Alunos</a></li>
                        <li><a href="#" class="menu-item" data-target="produtos">Produtos</a></li>
                        <li><a href="#" class="menu-item" data-target="consumo">Registrar Consumo</a></li>
                        <li><a href="#" class="menu-item" data-target="relatorios">Relatórios</a></li>
                        <li><a href="#" class="menu-item" data-target="mensagens">Mensagens</a></li>
                    </ul>
                </nav>
            </header>
            
            <main>
                <!-- Tela inicial -->
                <section id="home" class="page active">
                    <div class="dashboard">
                        <h2>Dashboard</h2>
                        <div class="cards">
                            <div class="card">
                                <i class="fas fa-user-graduate"></i>
                                <h3>Alunos</h3>
                                <p id="total-alunos">0 cadastrados</p>
                                <button class="btn-primary" onclick="navegarPara('alunos')">Gerenciar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-cookie-bite"></i>
                                <h3>Produtos</h3>
                                <p id="total-produtos">0 cadastrados</p>
                                <button class="btn-primary" onclick="navegarPara('produtos')">Gerenciar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-cash-register"></i>
                                <h3>Vendas Hoje</h3>
                                <p id="vendas-hoje">R$ 0,00</p>
                                <button class="btn-primary" onclick="navegarPara('consumo')">Registrar</button>
                            </div>
                            <div class="card">
                                <i class="fas fa-chart-line"></i>
                                <h3>Relatórios</h3>
                                <p>Visualizar resumos</p>
                                <button class="btn-primary" onclick="navegarPara('relatorios')">Acessar</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cadastro de alunos -->
                <section id="alunos" class="page">
                    <h2>Cadastro de Alunos</h2>
                    <div class="form-container">
                        <form id="aluno-form">
                            <div class="form-group">
                                <label for="nome-aluno">Nome do Aluno:</label>
                                <input type="text" id="nome-aluno" required>
                            </div>
                            <div class="form-group">
                                <label for="serie-aluno">Série:</label>
                                <select id="serie-aluno" required>
                                    <option value="">Selecione a série</option>
                                    <option value="Maternal">Maternal</option>
                                    <option value="Jardim I">Jardim I</option>
                                    <option value="Jardim II">Jardim II</option>
                                    <option value="1º ano">1º ano</option>
                                    <option value="2º ano">2º ano</option>
                                    <option value="3º ano">3º ano</option>
                                    <option value="4º ano">4º ano</option>
                                    <option value="5º ano">5º ano</option>
                                    <option value="6º ano">6º ano</option>
                                    <option value="7º ano">7º ano</option>
                                    <option value="8º ano">8º ano</option>
                                    <option value="9º ano">9º ano</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="responsavel-aluno">Nome do Responsável:</label>
                                <input type="text" id="responsavel-aluno" required>
                            </div>
                            <div class="form-group">
                                <label for="contato-aluno">WhatsApp do Responsável:</label>
                                <input type="tel" id="contato-aluno" placeholder="(XX) XXXXX-XXXX" required>
                            </div>
                            <div class="form-group">
                                <label for="pix-aluno">Chave PIX:</label>
                                <input type="text" id="pix-aluno">
                            </div>
                            <div class="buttons">
                                <button type="submit" class="btn-primary">Salvar</button>
                                <button type="reset" class="btn-secondary">Limpar</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="search-container">
                        <input type="text" id="buscar-aluno" placeholder="Buscar aluno...">
                        <button class="btn-search"><i class="fas fa-search"></i></button>
                    </div>

                    <div class="table-container">
                        <table id="tabela-alunos">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Série</th>
                                    <th>Responsável</th>
                                    <th>WhatsApp</th>
                                    <th>PIX</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dados dos alunos inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Cadastro de produtos -->
                <section id="produtos" class="page">
                    <h2>Cadastro de Produtos</h2>
                    <div class="form-container">
                        <form id="produto-form">
                            <div class="form-group">
                                <label for="nome-produto">Nome do Produto:</label>
                                <input type="text" id="nome-produto" required>
                            </div>
                            <div class="form-group">
                                <label for="preco-produto">Preço (R$):</label>
                                <input type="number" id="preco-produto" min="0.01" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="imagem-produto">Imagem (URL):</label>
                                <input type="url" id="imagem-produto" placeholder="https://...">
                            </div>
                            <div class="buttons">
                                <button type="submit" class="btn-primary">Salvar</button>
                                <button type="reset" class="btn-secondary">Limpar</button>
                            </div>
                        </form>
                    </div>

                    <div class="search-container">
                        <input type="text" id="buscar-produto" placeholder="Buscar produto...">
                        <button class="btn-search"><i class="fas fa-search"></i></button>
                    </div>

                    <div class="produtos-grid" id="lista-produtos">
                        <!-- Produtos serão inseridos via JavaScript -->
                    </div>
                </section>

                <!-- Registro de consumo -->
                <section id="consumo" class="page">
                    <h2>Registro de Consumo</h2>
                    
                    <div class="form-container">
                        <form id="consumo-form">
                            <div class="form-group">
                                <label for="aluno-consumo">Selecione o Aluno:</label>
                                <select id="aluno-consumo" required>
                                    <option value="">Selecione um aluno</option>
                                    <!-- Opções preenchidas via JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="data-consumo">Data:</label>
                                <input type="date" id="data-consumo" required>
                            </div>

                            <h3>Selecione os Produtos</h3>
                            <div id="produtos-consumo" class="produtos-selecao">
                                <!-- Produtos serão inseridos via JavaScript -->
                            </div>

                            <div class="resumo-consumo">
                                <h3>Resumo do Pedido</h3>
                                <div id="itens-selecionados">
                                    <!-- Itens selecionados serão inseridos via JavaScript -->
                                    <p class="empty-message">Nenhum item selecionado</p>
                                </div>
                                <div class="total">
                                    <p>Total: <span id="total-consumo">R$ 0,00</span></p>
                                </div>
                            </div>

                            <div class="buttons">
                                <button type="submit" class="btn-primary">Registrar Consumo</button>
                                <button type="reset" class="btn-secondary">Limpar</button>
                            </div>
                        </form>
                    </div>

                    <div class="historico-container">
                        <h3>Consumos Recentes</h3>
                        <div class="table-container">
                            <table id="tabela-consumos">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Aluno</th>
                                        <th>Itens</th>
                                        <th>Total</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados dos consumos inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Relatórios -->
                <section id="relatorios" class="page">
                    <h2>Relatórios Semanais</h2>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label for="semana-relatorio">Selecione a Semana:</label>
                            <input type="week" id="semana-relatorio" required>
                        </div>
                        <div class="form-group">
                            <label for="aluno-relatorio">Aluno (opcional):</label>
                            <select id="aluno-relatorio">
                                <option value="">Todos os alunos</option>
                                <!-- Opções preenchidas via JavaScript -->
                            </select>
                        </div>
                        <div class="buttons">
                            <button id="gerar-relatorio" class="btn-primary">Gerar Relatório</button>
                            <button id="exportar-relatorio" class="btn-secondary">Exportar CSV</button>
                        </div>
                    </div>

                    <div id="resultado-relatorio" class="relatorio-container">
                        <h3>Resumo Semanal</h3>
                        <div class="table-container">
                            <table id="tabela-relatorio">
                                <thead>
                                    <tr>
                                        <th>Aluno</th>
                                        <th>Série</th>
                                        <th>Itens Consumidos</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados do relatório inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Mensagens WhatsApp -->
                <section id="mensagens" class="page">
                    <h2>Envio de Mensagens</h2>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label for="semana-mensagem">Selecione a Semana:</label>
                            <input type="week" id="semana-mensagem" required>
                        </div>
                        <div class="buttons">
                            <button id="gerar-mensagens" class="btn-primary">Gerar Mensagens</button>
                        </div>
                    </div>

                    <div id="lista-mensagens" class="mensagens-container">
                        <!-- Mensagens serão inseridas via JavaScript -->
                    </div>
                </section>
            </main>

            <footer>
                <p>© 2025 Sistema de Cantina do Erlach. Desenvolvida por Werisder</p>
            </footer>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, setDoc, deleteDoc, doc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyDckbCik-4x5nl1QU81q-sTmlhQQMnBUII",
            authDomain: "cantinaescolar-d73bc.firebaseapp.com",
            projectId: "cantinaescolar-d73bc",
            storageBucket: "cantinaescolar-d73bc.appspot.com",
            messagingSenderId: "457335631363",
            appId: "1:457335631363:web:cbd9b38e1be1bb50d56836"
        };
    
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
    
        console.log("Firebase inicializado:", app.name);
        console.log("Firestore:", db);
        console.log("Auth:", auth);
    
        window.db = db;
        window.firestoreModules = { collection, onSnapshot, addDoc, setDoc, deleteDoc, doc, getDocs, query, where };
        window.firebaseAuthModules = { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged };
    </script>
    <script defer src="src/main.js"></script>